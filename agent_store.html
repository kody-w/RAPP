<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAPP Agent Store - AI Agent Marketplace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --gray: #6b7280;
            --light: #f9fafb;
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light);
            color: var(--dark);
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cart-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            position: relative;
            transition: all 0.3s ease;
        }

        .cart-button:hover {
            background: white;
            color: var(--primary);
        }

        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Search & Filter Bar */
        .toolbar {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            color: var(--gray);
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-card .label {
            color: var(--gray);
            margin-top: 0.5rem;
        }

        /* Agent Grid */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .agent-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
        }

        .agent-card.in-cart {
            border-color: var(--success);
        }

        .agent-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
        }

        .agent-category {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .agent-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .agent-rating {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            font-size: 0.9rem;
        }

        .agent-body {
            padding: 1.5rem;
        }

        .agent-description {
            color: var(--gray);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .agent-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tag {
            background: var(--light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .agent-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--light);
            border-radius: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat .value {
            font-weight: bold;
            color: var(--dark);
        }

        .stat .label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .agent-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        /* Cart Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 2rem;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 1rem;
        }

        .cart-item-info h3 {
            margin-bottom: 0.25rem;
        }

        .cart-item-info p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .remove-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .cart-summary {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--light);
            border-radius: 10px;
        }

        .cart-summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .cart-summary-row.total {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border);
        }

        .export-btn {
            width: 100%;
            margin-top: 1.5rem;
            background: var(--success);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
        }

        .export-btn:hover {
            background: #059669;
        }

        .empty-cart {
            text-align: center;
            padding: 3rem 1rem;
        }

        .empty-cart-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* File Browser Modal */
        .file-browser-modal .modal-content {
            max-width: 900px;
        }

        .file-list {
            margin-top: 1rem;
        }

        .file-category {
            margin-bottom: 1.5rem;
        }

        .file-category-header {
            background: var(--primary);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--light);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .file-item:hover {
            background: var(--border);
        }

        .file-checkbox {
            margin-right: 1rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .file-meta {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .file-type-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .file-type-agent {
            background: #dbeafe;
            color: #1e40af;
        }

        .file-type-ui {
            background: #fef3c7;
            color: #92400e;
        }

        .file-type-doc {
            background: #d1fae5;
            color: #065f46;
        }

        .file-type-config {
            background: #e0e7ff;
            color: #3730a3;
        }

        .bulk-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .bulk-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .bulk-btn-select-all {
            background: var(--primary);
            color: white;
        }

        .bulk-btn-clear {
            background: var(--light);
            color: var(--dark);
        }

        /* Chat Interface */
        .chat-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 400px;
            max-height: 600px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            z-index: 2000;
        }

        .chat-container.active {
            display: flex;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            max-height: 400px;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.75rem;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .message-avatar.user {
            background: var(--primary);
            color: white;
        }

        .message-avatar.assistant {
            background: var(--light);
        }

        .message-content {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            line-height: 1.5;
        }

        .chat-message.user .message-content {
            background: var(--primary);
            color: white;
        }

        .chat-message.assistant .message-content {
            background: var(--light);
            color: var(--dark);
        }

        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid var(--border);
        }

        .chat-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            resize: none;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .chat-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 1999;
        }

        .chat-toggle:hover {
            transform: scale(1.1);
        }

        .chat-toggle.active {
            display: none;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 4px solid var(--light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Enhanced Modal Styles */
        #stackModalBackdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 2rem;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .stack-modal {
            background: white;
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 9999;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header-section {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            margin: 0;
            color: #333;
            font-size: 1.8rem;
        }

        .modal-subtitle {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .modal-close-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.2s;
        }

        .modal-close-btn:hover {
            background: #dc2626;
        }

        .modal-badges {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .modal-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
        }

        .modal-section {
            margin-bottom: 2rem;
        }

        .modal-section-title {
            color: #333;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .modal-section-content {
            color: #666;
            line-height: 1.6;
        }

        .tech-requirements-box {
            background: #fef3c7;
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #fbbf24;
        }

        .tech-req-item {
            margin-bottom: 0.75rem;
        }

        .tech-req-item:last-child {
            margin-bottom: 0;
        }

        .tech-req-label {
            color: #92400e;
            font-weight: 600;
        }

        .tech-req-value {
            color: #78350f;
            margin-left: 0.5rem;
        }

        .component-item {
            background: #f9fafb;
            padding: 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 3px solid #3b82f6;
        }

        .component-name {
            font-weight: 600;
            color: #333;
        }

        .component-role {
            color: #6b7280;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .component-description {
            color: #666;
            margin: 0.5rem 0 0 0;
            font-size: 0.9rem;
        }

        .demo-box {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid #10b981;
        }

        .demo-title {
            color: #065f46;
            margin: 0 0 0.75rem 0;
        }

        .demo-description {
            color: #047857;
            margin: 0 0 1rem 0;
            font-size: 0.95rem;
        }

        .demo-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            width: 100%;
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.2);
            transition: transform 0.2s;
        }

        .demo-btn:hover {
            transform: translateY(-2px);
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e5e7eb;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .modal-btn-primary {
            background: #10b981;
            color: white;
        }

        .modal-btn-primary:hover {
            background: #059669;
        }

        .modal-btn-secondary {
            background: #3b82f6;
            color: white;
        }

        .modal-btn-secondary:hover {
            background: #2563eb;
        }

        .modal-btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }

        .modal-btn-warning:hover {
            box-shadow: 0 6px 8px rgba(245, 158, 11, 0.4);
        }

        .modal-btn-disabled {
            background: #6b7280;
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .agent-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .toolbar {
                flex-direction: column;
            }

            #stackModalBackdrop {
                padding: 1rem;
            }

            .stack-modal {
                max-height: 95vh;
            }

            .modal-actions {
                flex-direction: column;
            }

            .modal-btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-content">
            <h1>üõçÔ∏è RAPP Agent Store</h1>
            <button class="cart-button" onclick="openCart()">
                üõí Cart
                <span class="cart-badge" id="cartCount">0</span>
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Search & Filter Toolbar -->
        <div class="toolbar">
            <div class="search-box">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" placeholder="Search agents by name, tags, or description..." onkeyup="filterAgents()">
            </div>
            <select class="filter-select" id="categoryFilter" onchange="filterAgents()">
                <option value="">All Categories</option>
                <option value="B2B Sales">üíº B2B Sales</option>
                <option value="B2C Sales">üõí B2C Sales</option>
                <option value="Development">üíª Development</option>
                <option value="Energy">‚ö° Energy</option>
                <option value="Federal Government">üèõÔ∏è Federal Government</option>
                <option value="Financial Services">üí∞ Financial Services</option>
                <option value="Healthcare">üè• Healthcare</option>
                <option value="Manufacturing">üè≠ Manufacturing</option>
                <option value="Professional Services">üìä Professional Services</option>
                <option value="Retail & CPG">üè™ Retail & CPG</option>
                <option value="State/Local Government">üè¢ State/Local Government</option>
                <option value="Utilities">üîß Utilities</option>
            </select>
            <select class="filter-select" id="sortFilter" onchange="sortAgents()">
                <option value="popular">Most Popular</option>
                <option value="rating">Highest Rated</option>
                <option value="newest">Newest</option>
                <option value="name">Name (A-Z)</option>
            </select>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="value" id="totalAgents">78</div>
                <div class="label">Available Agents</div>
            </div>
            <div class="stat-card">
                <div class="value" id="totalInstalls">78.0K</div>
                <div class="label">Total Installs</div>
            </div>
            <div class="stat-card">
                <div class="value">4.5</div>
                <div class="label">Average Rating</div>
            </div>
            <div class="stat-card">
                <div class="value" id="cartItems">0</div>
                <div class="label">In Your Cart</div>
            </div>
        </div>

        <!-- Agent Grid -->
        <div id="agentGrid" class="agent-grid">
            <!-- Agents will be loaded here -->
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üõí Your Cart</h2>
                <button class="modal-close" onclick="closeCart()">&times;</button>
            </div>
            <div class="modal-body" id="cartBody">
                <!-- Cart items will be loaded here -->
            </div>
        </div>
    </div>

    <!-- File Browser Modal -->
    <div id="fileBrowserModal" class="modal file-browser-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÅ Browse Stack Files</h2>
                <button class="modal-close" onclick="closeFileBrowser()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="bulk-actions">
                    <button class="bulk-btn bulk-btn-select-all" onclick="selectAllFiles()">Select All</button>
                    <button class="bulk-btn bulk-btn-clear" onclick="clearAllFiles()">Clear All</button>
                    <button class="btn btn-primary" onclick="addSelectedFilesToCart()">Add Selected to Cart</button>
                </div>
                <div id="fileBrowserContent">
                    <!-- File list will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Interface -->
    <button class="chat-toggle" id="chatToggle" onclick="toggleChat()">üí¨</button>
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <h3>ü§ñ RAPP Assistant</h3>
            <button class="modal-close" onclick="toggleChat()">&times;</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message assistant">
                <div class="message-avatar assistant">ü§ñ</div>
                <div class="message-content">
                    Hi! I'm your RAPP assistant. I can help you discover agents, explain features, or answer questions about the marketplace. What can I help you with?
                </div>
            </div>
        </div>
        <div class="chat-input-container">
            <textarea class="chat-input" id="chatInput" rows="2" placeholder="Ask me anything about RAPP agents..." onkeypress="handleChatKeyPress(event)"></textarea>
        </div>
    </div>

    <script>
        // GitHub Configuration - Static agent store pulls from RAPP repository
        const GITHUB_CONFIG = {
            owner: 'kody-w',  // Update this to your GitHub username
            repo: 'RAPP',
            branch: 'main',
            subPath: 'AI-Agent-Templates',
            baseUrl: 'https://github.com/kody-w/RAPP',
            rawUrl: 'https://raw.githubusercontent.com/kody-w/RAPP/main/AI-Agent-Templates'
        };

        // Category mapping to directory structure
        const CATEGORY_TO_DIR = {
            'B2B Sales': 'b2b_sales_stacks',
            'B2C Sales': 'b2c_sales_stacks',
            'Customer Service': 'customer_service_stacks',
            'Energy': 'energy_stacks',
            'Federal Government': 'federal_government_stacks',
            'Financial Services': 'financial_services_stacks',
            'Healthcare': 'healthcare_stacks',
            'Human Resources': 'human_resources_stacks',
            'Development': 'it_management_stacks',
            'Manufacturing': 'manufacturing_stacks',
            'Professional Services': 'professional_services_stacks',
            'Retail & CPG': 'retail_cpg_stacks',
            'State/Local Government': 'slg_government_stacks',
            'Utilities': 'general_stacks'
        };

        // Agent catalog - loaded dynamically from manifest.json
        let agents = [];
        let manifestLoading = true;

        // Shopping cart for agents
        let cart = JSON.parse(localStorage.getItem('rapp_agent_cart')) || [];

        // Current stack being browsed
        let currentStackFiles = [];
        let currentStackId = null;

        // Chat conversation history (deprecated in static mode)
        let chatHistory = [];

        // Minimal fallback data for offline mode (kept small)
        const fallbackAgents = [
            {
                id: 'permit-license-management',
                name: 'Permit & License Management Agent Stack',
                category: 'Energy',
                shortDescription: 'Automates renewal and tracking of operational permits',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: '‚ö°'
            },
            {
                id: 'field-service-dispatch',
                name: 'Field Service Dispatch Agent Stack',
                category: 'Energy',
                shortDescription: 'Optimizes technician dispatch based on skills, location, and urgency',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: '‚ö°'
            },
            {
                id: 'regulatory-reporting',
                name: 'Regulatory Reporting Agent Stack',
                category: 'Energy',
                shortDescription: 'Auto-generates EPA/FERC/OSHA compliance documents',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: '‚ö°'
            },
            {
                id: 'emission-tracking',
                name: 'Emission Tracking Agent Stack',
                category: 'Energy',
                shortDescription: 'Tracks, analyzes, and reports carbon emissions across operations',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: '‚ö°'
            },
            {
                id: 'asset-maintenance-forecast',
                name: 'Asset Maintenance Forecast Agent Stack',
                category: 'Energy',
                shortDescription: 'Predicts equipment failure and schedules maintenance proactively',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: '‚ö°'
            },
            {
                id: 'cart-abandonment-recovery',
                name: 'Cart Abandonment Recovery Agent Stack',
                category: 'B2C Sales',
                shortDescription: 'Follows up to convert abandoned carts to sales',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üõí'
            },
            {
                id: 'returns-exchange',
                name: 'Returns & Exchange Agent Stack',
                category: 'B2C Sales',
                shortDescription: 'Automates return and refund workflows',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üõí'
            },
            {
                id: 'sales-chat',
                name: 'Sales Chat Agent',
                category: 'B2C Sales',
                shortDescription: 'Improves sales team access to CRM information, product inventory, and pricing opportunities through an intelligent chat interface',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üõí'
            },
            {
                id: 'customer-loyalty-rewards',
                name: 'Customer Loyalty & Rewards Agent Stack',
                category: 'B2C Sales',
                shortDescription: 'Manages loyalty programs and redemptions',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üõí'
            },
            {
                id: 'omnichannel-engagement',
                name: 'Omnichannel Engagement Agent Stack',
                category: 'B2C Sales',
                shortDescription: 'Coordinates messaging across all customer channels',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üõí'
            },
            {
                id: 'personalized-shopping-assistant',
                name: 'Personalized Shopping Assistant Stack',
                category: 'B2C Sales',
                shortDescription: 'Guides product discovery and purchase decisions',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üõí'
            },
            {
                id: 'personalized-marketing',
                name: 'Personalized Marketing Agent Stack',
                category: 'Retail & CPG',
                shortDescription: 'Creates targeted campaigns based on customer behavior',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè™'
            },
            {
                id: 'returns-complaints-resolution',
                name: 'Returns & Complaints Resolution Agent Stack',
                category: 'Retail & CPG',
                shortDescription: 'Handles customer issues and return processing',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè™'
            },
            {
                id: 'store-associate-copilot',
                name: 'Store Associate Copilot Stack',
                category: 'Retail & CPG',
                shortDescription: 'Assists staff with product information and promotions',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè™'
            },
            {
                id: 'inventory-visibility',
                name: 'Inventory Visibility Agent Stack',
                category: 'Retail & CPG',
                shortDescription: 'Provides real-time inventory across all channels',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè™'
            },
            {
                id: 'supply-chain-disruption-alert',
                name: 'Supply Chain Disruption Alert Agent Stack',
                category: 'Retail & CPG',
                shortDescription: 'Notifies of disruptions and recommends alternatives',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè™'
            },
            {
                id: 'client-health-score',
                name: 'Client Health Score Agent Stack',
                category: 'Professional Services',
                shortDescription: 'Aggregates sentiment, usage, and satisfaction metrics',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üìä'
            },
            {
                id: 'proposal-copilot',
                name: 'Proposal Co-Pilot Agent Stack',
                category: 'Professional Services',
                shortDescription: 'Builds proposals from requirements and templates',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üìä'
            },
            {
                id: 'contract-risk-review',
                name: 'Contract Risk Review Agent Stack',
                category: 'Professional Services',
                shortDescription: 'Reviews contracts for risk and compliance issues',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üìä'
            },
            {
                id: 'resource-utilization',
                name: 'Resource Utilization Agent Stack',
                category: 'Professional Services',
                shortDescription: 'Matches staff skills to project requirements optimally',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üìä'
            },
            {
                id: 'time-entry-billing',
                name: 'Time Entry & Billing Agent Stack',
                category: 'Professional Services',
                shortDescription: 'Auto-logs time and generates accurate invoices',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üìä'
            },
            {
                id: 'deal-progression',
                name: 'Deal Progression Agent Stack',
                category: 'B2B Sales',
                shortDescription: 'Comprehensive deal progression intelligence powered by Dynamics 365 - featuring 10 specialized agents for stalled deal detection, health scoring, next actions, stakeholder analysis, activity gaps, pipeline velocity, competitive intelligence, risk assessment, win probability, and forecast accuracy',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '2.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üíº'
            },
            {
                id: 'proposal-generation',
                name: 'Proposal Generation Agent Stack',
                category: 'B2B Sales',
                shortDescription: 'Creates tailored proposals from prior successful deals',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üíº'
            },
            {
                id: 'account-intelligence',
                name: 'Account Intelligence Stack',
                category: 'B2B Sales',
                shortDescription: 'Comprehensive B2B account intelligence integrated with Microsoft Copilot Studio, Dynamics 365, Microsoft Graph, LinkedIn Sales Navigator, and Azure OpenAI. Provides stakeholder analysis, competitive intelligence, meeting prep, risk assessment, and deal tracking.',
                tags: ["B2B Sales", "Account Intelligence", "Copilot Studio", "Dynamics 365", "Microsoft Graph", "Azure OpenAI", "Sales Enablement", "Deal Intelligence", "Stakeholder Analysis", "Competitive Intelligence"],
                rating: 4.5,
                installs: 1000,
                version: '2.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üíº'
            },
            {
                id: 'win-loss-analysis',
                name: 'Win/Loss Analysis Agent Stack',
                category: 'B2B Sales',
                shortDescription: 'Analyzes closed deals for trends and insights',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üíº'
            },
            {
                id: 'sales-qualification',
                name: 'Sales Qualification Agent Stack',
                category: 'B2B Sales',
                shortDescription: 'Assesses leads and prioritizes by fit and intent',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üíº'
            },
            {
                id: 'supplier-risk-monitoring',
                name: 'Supplier Risk Monitoring Agent Stack',
                category: 'Manufacturing',
                shortDescription: 'Detects supply chain risks and recommends mitigation strategies',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè≠'
            },
            {
                id: 'production-line-optimization',
                name: 'Production Line Optimization Agent Stack',
                category: 'Manufacturing',
                shortDescription: 'Analyzes production output and suggests efficiency improvements',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè≠'
            },
            {
                id: 'inventory-rebalancing',
                name: 'Inventory Rebalancing Agent Stack',
                category: 'Manufacturing',
                shortDescription: 'Prevents overstock and stockouts through intelligent rebalancing',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè≠'
            },
            {
                id: 'maintenance-scheduling',
                name: 'Maintenance Scheduling Agent Stack',
                category: 'Manufacturing',
                shortDescription: 'Reduces downtime by predicting equipment failures',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè≠'
            },
            {
                id: 'order-status-communication',
                name: 'Order Status Communication Agent Stack',
                category: 'Manufacturing',
                shortDescription: 'Provides live updates on manufacturing and delivery status',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè≠'
            },
            {
                id: 'competitive-intel',
                name: 'Competitive Intelligence Agent Stack',
                category: 'Development',
                shortDescription: 'Pulls competitor news, pricing, and feature updates',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üöÄ'
            },
            {
                id: 'license-renewal-expansion',
                name: 'License Renewal & Expansion Agent Stack',
                category: 'Development',
                shortDescription: 'Flags expiring licenses and triggers customer success motions',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üöÄ'
            },
            {
                id: 'product-feedback-synthesizer',
                name: 'Product Feedback Synthesizer Stack',
                category: 'Development',
                shortDescription: 'Analyzes customer feedback for feature requests and fixes',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üöÄ'
            },
            {
                id: 'customer-onboarding',
                name: 'Customer Onboarding Agent Stack',
                category: 'Development',
                shortDescription: 'Walks users through setup and configuration processes',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üöÄ'
            },
            {
                id: 'support-ticket-resolution',
                name: 'Support Ticket Resolution Agent Stack',
                category: 'Development',
                shortDescription: 'Resolves L1/L2 support tickets autonomously',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üöÄ'
            },
            {
                id: 'staff-credentialing',
                name: 'Staff Credentialing Agent Stack',
                category: 'Healthcare',
                shortDescription: 'Automates tracking and renewal of healthcare staff credentials',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè•'
            },
            {
                id: 'clinical-notes-summarizer',
                name: 'Clinical Notes Summarizer Stack',
                category: 'Healthcare',
                shortDescription: 'Generates real-time summaries from provider-patient conversations',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè•'
            },
            {
                id: 'care-gap-closure',
                name: 'Care Gap Closure Agent Stack',
                category: 'Healthcare',
                shortDescription: 'Identifies missing screenings and automates patient outreach',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè•'
            },
            {
                id: 'patient-intake',
                name: 'Patient Intake & Scheduling Agent Stack',
                category: 'Healthcare',
                shortDescription: 'Automates patient intake, appointment coordination, and reminders to reduce no-shows. Integrates with major EHR systems and CRM platforms.',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè•'
            },
            {
                id: 'prior-authorization',
                name: 'Prior Authorization Automation Stack',
                category: 'Healthcare',
                shortDescription: 'Automates prior authorization processes by integrating with EHR systems and payer portals to speed up approvals and reduce manual interactions',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè•'
            },
            {
                id: 'mission-reporting-assistant',
                name: 'Mission Reporting Assistant Stack',
                category: 'Federal Government',
                shortDescription: 'Generates reports from classified and unclassified sources',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üèõÔ∏è'
            },
            {
                id: 'acquisition-support',
                name: 'Acquisition Support Agent Stack',
                category: 'Federal Government',
                shortDescription: 'Summarizes proposals and checks procurement compliance',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üèõÔ∏è'
            },
            {
                id: 'regulatory-compliance-fed',
                name: 'Regulatory Compliance Agent Stack',
                category: 'Federal Government',
                shortDescription: 'Monitors and reports FedRAMP/NIST compliance',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üèõÔ∏è'
            },
            {
                id: 'workforce-clearance-onboarding',
                name: 'Workforce Clearance & Onboarding Agent Stack',
                category: 'Federal Government',
                shortDescription: 'Streamlines background checks and training',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üèõÔ∏è'
            },
            {
                id: 'federal-grants-oversight',
                name: 'Federal Grants Oversight Agent Stack',
                category: 'Federal Government',
                shortDescription: 'Tracks grant spending, risk, and reporting',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üèõÔ∏è'
            },
            {
                id: 'financial-advisor-copilot',
                name: 'Financial Advisor Copilot Stack',
                category: 'Financial Services',
                shortDescription: 'Surfaces investment strategies and client insights',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'fraud-detection-alert',
                name: 'Fraud Detection & Alert Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Monitors transactions for suspicious activity patterns',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'regulatory-compliance-fs',
                name: 'Regulatory Compliance Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Ensures AML and GDPR compliance adherence',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'customer-onboarding-fs',
                name: 'Customer Onboarding Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Automates KYC and account setup processes',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'underwriting-support',
                name: 'Underwriting Support Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Pulls risk data and summarizes applications',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'customer-sentiment-churn',
                name: 'Customer Sentiment & Churn Risk Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Analyzes interactions to identify at-risk customers',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'portfolio-rebalancing',
                name: 'Portfolio Rebalancing Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Detects drift and recommends rebalancing actions',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'claims-processing',
                name: 'Claims Processing Agent Stack',
                category: 'Financial Services',
                shortDescription: 'Automates insurance claim intake and processing',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'loan-origination-assistant',
                name: 'Loan Origination Assistant Stack',
                category: 'Financial Services',
                shortDescription: 'Streamlines loan application and credit assessment',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'wealth-insights-generator',
                name: 'Wealth Insights Generator Stack',
                category: 'Financial Services',
                shortDescription: 'Consolidates assets and generates comprehensive reports',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üí∞'
            },
            {
                id: 'sales-coach',
                name: 'Sales Coach Stack',
                category: 'Utilities',
                shortDescription: 'AI-powered sales training and coaching. Provides personalized feedback, role-play scenarios, and performance improvement.',
                tags: ["automation", "ai", "enterprise", "sales_enablement"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'procurement-support',
                name: 'Procurement Support Stack',
                category: 'Utilities',
                shortDescription: 'Streamline procurement with automated vendor selection, PO creation, and spend analysis.',
                tags: ["automation", "ai", "enterprise", "procurement"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'customer-360',
                name: 'Customer 360 Stack',
                category: 'Utilities',
                shortDescription: 'Comprehensive customer data aggregation and insights platform. Unify customer data from all touchpoints to create actionable 360-degree customer profiles.',
                tags: ["customer-360", "cdp", "customer-intelligence", "analytics", "personalization", "data-aggregation", "predictive-analytics"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Customer Intelligence Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'cross-selling-opportunities',
                name: 'Cross-Selling Opportunities Stack',
                category: 'Utilities',
                shortDescription: 'Identify upsell and cross-sell opportunities based on customer behavior and purchase patterns.',
                tags: ["automation", "ai", "enterprise", "revenue_optimization"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'procurement-agent',
                name: 'Procurement Agent',
                category: 'Utilities',
                shortDescription: 'Streamlines procurement processes with Microsoft Teams integration for vendor management, purchase orders, and approval workflows',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'find-accurate-models',
                name: 'Find Accurate Models Stack',
                category: 'Utilities',
                shortDescription: 'Locate and recommend the most accurate AI models and configurations for specific use cases.',
                tags: ["automation", "ai", "enterprise", "ai_optimization"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'crm-bulk-data-creator',
                name: 'CRM Bulk Data Creator Stack',
                category: 'Utilities',
                shortDescription: 'Automated bulk data generation and import for CRM systems. Create thousands of test records, realistic customer data, and complex relationship structures.',
                tags: ["crm", "bulk-data", "dynamics-365", "test-data", "data-generation", "automation", "testing", "training"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'triage-bot',
                name: 'Triage Bot Stack',
                category: 'Utilities',
                shortDescription: 'Intelligent request prioritization and routing based on urgency, impact, and available resources.',
                tags: ["automation", "ai", "enterprise", "workflow_automation"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'it-ticket-management',
                name: 'IT Ticket Management Stack',
                category: 'Utilities',
                shortDescription: 'Automate IT support ticket routing, prioritization, and resolution with intelligent triage.',
                tags: ["automation", "ai", "enterprise", "it_operations"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'voice-to-crm',
                name: 'Voice to CRM Integration Stack',
                category: 'Utilities',
                shortDescription: 'A comprehensive voice-enabled CRM data entry solution that converts speech to text and automatically creates CRM records in Dynamics 365, ServiceNow, and other platforms.',
                tags: ["voice", "crm", "dynamics-365", "servicenow", "speech-to-text", "automation", "accessibility", "field-service", "sales", "customer-service"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Accelerate Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'simulation-sales',
                name: 'AI Sales Simulation Stack',
                category: 'Utilities',
                shortDescription: 'Advanced sales training and simulation platform. Practice sales scenarios, receive AI coaching, and improve closing rates through realistic simulations.',
                tags: ["sales-training", "simulation", "ai-coaching", "gamification", "performance", "training", "sales-enablement"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Sales Excellence Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'ai-customer-assistant',
                name: 'AI Customer Assistant Stack',
                category: 'Utilities',
                shortDescription: 'Intelligent customer service automation. Handle inquiries, resolve issues, and provide 24/7 support.',
                tags: ["automation", "ai", "enterprise", "customer_service"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'speech-to-crm',
                name: 'Speech to CRM Stack',
                category: 'Utilities',
                shortDescription: 'Convert voice conversations into structured CRM data. Automatically transcribe, analyze, and update CRM records from calls, meetings, and voice notes.',
                tags: ["speech-to-text", "crm", "voice", "automation", "nlp", "sales"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Voice Intelligence Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'email-drafting',
                name: 'Email Drafting Stack',
                category: 'Utilities',
                shortDescription: 'AI-powered email composition and automation. Generate professional emails, automate responses, and manage communication workflows.',
                tags: ["email", "ai-writing", "microsoft-365", "automation", "communication", "productivity", "nlp"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Communications Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'identify-discounts',
                name: 'Identify Discounts Stack',
                category: 'Utilities',
                shortDescription: 'Automatically identify and apply available discounts, promotions, and special pricing to maximize savings.',
                tags: ["automation", "ai", "enterprise", "pricing_optimization"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'product-reference',
                name: 'Product Reference Stack',
                category: 'Utilities',
                shortDescription: 'Comprehensive product information and recommendation system. Access detailed specs, comparisons, and intelligent search.',
                tags: ["automation", "ai", "enterprise", "product_intelligence"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'ask-hr',
                name: 'Ask HR Stack',
                category: 'Utilities',
                shortDescription: 'AI-powered HR assistant for employee questions about policies, benefits, and workplace matters.',
                tags: ["automation", "ai", "enterprise", "hr_automation"],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'Microsoft AI Solutions Team',
                sizeKb: 100,
                icon: 'üîß'
            },
            {
                id: 'building-permit-processing',
                name: 'Building Permit Processing Agent Stack',
                category: 'State/Local Government',
                shortDescription: 'Reviews applications and tracks permit status',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè¢'
            },
            {
                id: 'grants-management',
                name: 'Grants Management Agent Stack',
                category: 'State/Local Government',
                shortDescription: 'Automates grant intake, scoring, and tracking',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè¢'
            },
            {
                id: 'foia-request-assistant',
                name: 'FOIA Request Assistant Stack',
                category: 'State/Local Government',
                shortDescription: 'Automates document search and redaction for FOIA',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè¢'
            },
            {
                id: 'utility-billing-assistance',
                name: 'Utility Billing & Assistance Agent Stack',
                category: 'State/Local Government',
                shortDescription: 'Manages utility bills and assistance programs',
                tags: [],
                rating: 4.5,
                installs: 1000,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 100,
                icon: 'üè¢'
            },
            {
                id: 'sample-loading',
                name: 'Loading Agents...',
                category: 'Utilities',
                shortDescription: 'Loading agent catalog from GitHub...',
                tags: ['loading'],
                rating: 0,
                installs: 0,
                version: '1.0.0',
                author: 'RAPP',
                sizeKb: 0,
                icon: '‚è≥'
            }
        ];



        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAgentCatalog();
            updateCartCount();
        });

        // Load agent catalog from manifest.json (recommended pattern)
        async function loadAgentCatalog() {
            try {
                // Show loading state with fallback data
                agents = fallbackAgents;
                renderAgents();

                console.log('üîç Loading agent catalog from manifest.json...');

                // Detect local vs production environment
                const isLocal = window.location.hostname === 'localhost' ||
                               window.location.hostname === '127.0.0.1' ||
                               window.location.protocol === 'file:';

                // Try local manifest first if running locally, otherwise use GitHub URL
                const manifestUrl = isLocal
                    ? 'manifest.json'  // Relative path for local development
                    : `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/manifest.json`;

                console.log(`   Environment: ${isLocal ? 'Local' : 'Production'}`);
                console.log(`   Loading from: ${manifestUrl}`);

                const response = await fetch(manifestUrl);

                if (!response.ok) {
                    throw new Error(`Manifest not found (HTTP ${response.status})`);
                }

                const manifest = await response.json();

                // Validate manifest structure
                if (!manifest.agents || !Array.isArray(manifest.agents)) {
                    throw new Error('Invalid manifest format');
                }

                agents = manifest.agents;

                console.log(`‚úÖ Loaded ${agents.length} agents from manifest.json`);
                console.log(`   Version: ${manifest.version}`);
                console.log(`   Generated: ${manifest.generated}`);
                console.log(`   Categories: ${manifest.categories?.length || 'N/A'}`);

                manifestLoading = false;
                renderAgents();
                document.getElementById('totalAgents').textContent = agents.length;
                updateInstallStats();

            } catch (error) {
                console.error('‚ùå Failed to load manifest:', error);
                console.warn('‚ö†Ô∏è Falling back to embedded data');

                // Fallback: Load from embedded JavaScript file
                try {
                    const response = await fetch('agent_catalog_generated.js');
                    const jsCode = await response.text();

                    // Extract sampleAgents from JavaScript file
                    eval(jsCode);
                    if (typeof sampleAgents !== 'undefined') {
                        agents = sampleAgents;
                        console.log(`‚úÖ Loaded ${agents.length} agents from fallback JavaScript`);
                    } else {
                        throw new Error('sampleAgents not found in fallback file');
                    }
                } catch (fallbackError) {
                    console.error('‚ùå Fallback also failed:', fallbackError);

                    // Final fallback: Show error state
                    agents = [{
                        id: 'error-loading',
                        name: 'Failed to Load Agents',
                        category: 'Error',
                        shortDescription: 'Unable to load agent catalog. Please check your internet connection and try refreshing the page.',
                        tags: ['error'],
                        rating: 0,
                        installs: 0,
                        version: '0.0.0',
                        author: 'System',
                        sizeKb: 0,
                        icon: '‚ùå'
                    }];
                }

                manifestLoading = false;
                renderAgents();
                document.getElementById('totalAgents').textContent = agents.length;
                updateInstallStats();
            }
        }

        // Helper: Get GitHub directory path for an agent
        function getAgentGitHubPath(agentId, category) {
            const categoryDir = CATEGORY_TO_DIR[category] || 'general_stacks';
            // Convert hyphens to underscores for GitHub path
            const agentIdWithUnderscores = agentId.replace(/-/g, '_');
            const stackName = agentIdWithUnderscores + '_stack';
            return `${GITHUB_CONFIG.baseUrl}/tree/${GITHUB_CONFIG.branch}/${GITHUB_CONFIG.subPath}/agent_stacks/${categoryDir}/${stackName}`;
        }

        // Helper: Get GitHub raw file URL for an agent
        function getAgentRawUrl(agentId, category, filename) {
            const categoryDir = CATEGORY_TO_DIR[category] || 'general_stacks';
            // Convert hyphens to underscores for GitHub path
            const agentIdWithUnderscores = agentId.replace(/-/g, '_');
            const stackName = agentIdWithUnderscores + '_stack';
            return `${GITHUB_CONFIG.rawUrl}/agent_stacks/${categoryDir}/${stackName}/${filename}`;
        }

        // Update install statistics
        function updateInstallStats() {
            const totalInstalls = agents.reduce((sum, agent) => sum + agent.installs, 0);
            document.getElementById('totalInstalls').textContent = formatNumber(totalInstalls);
        }

        // Render agents
        function renderAgents() {
            const grid = document.getElementById('agentGrid');
            const filtered = getFilteredAgents();

            grid.innerHTML = filtered.map(agent => `
                <div class="agent-card ${isInCart(agent.id) ? 'in-cart' : ''}" data-id="${agent.id}">
                    <div class="agent-header">
                        <div class="agent-category">${agent.icon} ${agent.category}</div>
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-rating">
                            ‚≠ê ${agent.rating} | üì¶ ${formatNumber(agent.installs)} installs
                        </div>
                    </div>
                    <div class="agent-body">
                        <p class="agent-description">${agent.shortDescription}</p>
                        <div class="agent-tags">
                            ${agent.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                        </div>
                        <div class="agent-stats">
                            <div class="stat">
                                <div class="value">v${agent.version}</div>
                                <div class="label">Version</div>
                            </div>
                            <div class="stat">
                                <div class="value">${agent.sizeKb}KB</div>
                                <div class="label">Size</div>
                            </div>
                            <div class="stat">
                                <div class="value">${agent.author.split(' ')[0]}</div>
                                <div class="label">Author</div>
                            </div>
                        </div>
                        <div class="agent-actions">
                            <button class="btn btn-secondary" onclick="viewAgentDetails('${agent.id}')" style="width: 100%; margin-bottom: 0.5rem;">üëÅÔ∏è View Details</button>
                            ${isInCart(agent.id)
                                ? `<button class="btn btn-success" disabled>‚úì In Cart</button>`
                                : `<button class="btn btn-primary" onclick="addToCart('${agent.id}')">Add to Cart</button>`
                            }
                            <button class="btn btn-secondary" onclick="browseStackFiles('${agent.id}')">üìÅ Browse Files</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter agents
        function getFilteredAgents() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;

            let filtered = agents.filter(agent => {
                const matchesSearch = search === '' ||
                    agent.name.toLowerCase().includes(search) ||
                    agent.shortDescription.toLowerCase().includes(search) ||
                    agent.tags.some(tag => tag.toLowerCase().includes(search));

                const matchesCategory = category === '' || agent.category === category;

                return matchesSearch && matchesCategory;
            });

            return sortAgentsList(filtered);
        }

        function filterAgents() {
            renderAgents();
            document.getElementById('totalAgents').textContent = getFilteredAgents().length;
        }

        // Sort agents
        function sortAgentsList(agentList) {
            const sort = document.getElementById('sortFilter').value;

            switch(sort) {
                case 'popular':
                    return agentList.sort((a, b) => b.installs - a.installs);
                case 'rating':
                    return agentList.sort((a, b) => b.rating - a.rating);
                case 'name':
                    return agentList.sort((a, b) => a.name.localeCompare(b.name));
                case 'newest':
                    return agentList.sort((a, b) => b.version.localeCompare(a.version));
                default:
                    return agentList;
            }
        }

        function sortAgents() {
            renderAgents();
        }

        // Cart functions
        function isInCart(itemId) {
            return cart.some(item => item.id === itemId);
        }

        function addToCart(agentId) {
            const agent = agents.find(a => a.id === agentId);
            if (agent && !isInCart(agentId)) {
                cart.push({
                    type: 'agent',
                    id: agent.id,
                    name: agent.name,
                    category: agent.category,
                    sizeKb: agent.sizeKb,
                    path: `agent_stacks/${agent.category.toLowerCase()}_stack/${agent.id}.py`,
                    addedAt: new Date().toISOString()
                });
                saveCart();
                updateCartCount();
                renderAgents();
            }
        }

        function addFileToCart(file) {
            if (!isInCart(file.id)) {
                cart.push({
                    type: file.type,
                    id: file.id,
                    name: file.name,
                    path: file.path,
                    size: file.size || 0,
                    category: file.category || file.type,
                    addedAt: new Date().toISOString()
                });
                saveCart();
                updateCartCount();
            }
        }

        function removeFromCart(itemId) {
            cart = cart.filter(item => item.id !== itemId);
            saveCart();
            updateCartCount();
            renderCart();
            renderAgents();
        }

        function saveCart() {
            localStorage.setItem('rapp_agent_cart', JSON.stringify(cart));
        }

        function updateCartCount() {
            const count = cart.length;
            document.getElementById('cartCount').textContent = count;
            document.getElementById('cartItems').textContent = count;
        }

        // Cart modal
        function openCart() {
            document.getElementById('cartModal').classList.add('active');
            renderCart();
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
        }

        function renderCart() {
            const cartBody = document.getElementById('cartBody');

            if (cart.length === 0) {
                cartBody.innerHTML = `
                    <div class="empty-cart">
                        <div class="empty-cart-icon">üõí</div>
                        <h3>Your cart is empty</h3>
                        <p style="color: var(--gray); margin-top: 0.5rem;">Browse agents and add them to your cart to get started!</p>
                    </div>
                `;
                return;
            }

            // Group items by type
            const byType = {
                agent: [],
                ui: [],
                doc: [],
                config: [],
                other: []
            };

            cart.forEach(item => {
                const type = item.type || 'other';
                if (byType[type]) {
                    byType[type].push(item);
                } else {
                    byType.other.push(item);
                }
            });

            const totalSize = cart.reduce((sum, item) => sum + (item.sizeKb || item.size || 0), 0);

            const typeIcons = {
                agent: 'ü§ñ',
                ui: 'üé®',
                doc: 'üìö',
                config: '‚öôÔ∏è',
                other: 'üì¶'
            };

            const typeLabels = {
                agent: 'Agents',
                ui: 'UI Files',
                doc: 'Documentation',
                config: 'Configuration',
                other: 'Other Files'
            };

            let html = '';

            // Render items grouped by type
            for (const [type, items] of Object.entries(byType)) {
                if (items.length > 0) {
                    html += `
                        <h3 style="margin-bottom: 0.75rem; color: var(--primary);">${typeIcons[type]} ${typeLabels[type]} (${items.length})</h3>
                        ${items.map(item => `
                            <div class="cart-item">
                                <div class="cart-item-info">
                                    <h3>${item.name}</h3>
                                    <p>${item.category} | ${item.sizeKb || item.size || '?'}KB</p>
                                </div>
                                <button class="remove-btn" onclick="removeFromCart('${item.id}')">Remove</button>
                            </div>
                        `).join('')}
                    `;
                }
            }

            html += `
                <div class="cart-summary">
                    <div class="cart-summary-row">
                        <span>Total Items:</span>
                        <strong>${cart.length}</strong>
                    </div>
                    <div class="cart-summary-row">
                        <span>Total Size:</span>
                        <strong>~${totalSize}KB</strong>
                    </div>
                    <div class="cart-summary-row total">
                        <span>Ready to Download:</span>
                        <strong>${cart.length} files</strong>
                    </div>
                </div>

                <button class="export-btn" onclick="exportCart()">
                    üì¶ Generate Download Script
                </button>
            `;

            cartBody.innerHTML = html;
        }

        // Export cart - calls GitHubAgentLibraryManager create_group
        function exportCart() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }

            // Show loading state
            const exportBtn = event.target;
            const originalText = exportBtn.textContent;
            exportBtn.textContent = 'üì¶ Generating Package...';
            exportBtn.disabled = true;

            try {
                const timestamp = new Date().toISOString().split('T')[0];

                // Generate download script for all agents in cart
                let downloadScript = `#!/bin/bash
# RAPP Agent Installation Script
# Generated: ${new Date().toISOString()}
# Agents: ${cart.length}

set -e  # Exit on error

echo "üöÄ RAPP Agent Installation Script"
echo "=================================="
echo ""
echo "üì¶ Installing ${cart.length} agent stack(s) from GitHub..."
echo ""

# Create agents directory if it doesn't exist
mkdir -p agents

`;

                // Generate download commands for each agent
                cart.forEach((item, index) => {
                    const agent = agents.find(a => a.id === item.id);
                    const categoryDir = CATEGORY_TO_DIR[agent.category] || 'general_stacks';

                    // Agent ID uses hyphens for display, but filenames use underscores
                    const agentIdWithUnderscores = agent.id.replace(/-/g, '_');
                    const stackName = agentIdWithUnderscores + '_stack';
                    const agentFileName = agentIdWithUnderscores + '_agent.py';
                    const baseUrl = `${GITHUB_CONFIG.rawUrl}/agent_stacks/${categoryDir}/${stackName}`;

                    downloadScript += `# ${index + 1}. ${agent.name}\n`;
                    downloadScript += `echo "Installing: ${agent.name}..."\n`;
                    downloadScript += `curl -sSL "${baseUrl}/agents/${agentFileName}" -o "agents/${agentFileName}"\n`;
                    downloadScript += `echo "‚úì ${agent.name} installed"\n\n`;
                });

                downloadScript += `echo ""
echo "‚úÖ Installation complete!"
echo ""
echo "üìÅ Agents installed to: ./agents/"
echo ""
echo "üîß To use these agents with RAPP:"
echo "1. Copy the agents/*.py files to your RAPP agents/ directory"
echo "2. Restart your RAPP backend: ./run.sh"
echo "3. The agents will be automatically loaded"
echo ""
echo "üåê Or upload to Azure Storage:"
echo "   Use AzureFileStorageManager to upload to 'agents' share"
echo ""
`;

                // Create export package with GitHub URLs
                const exportPackage = {
                    version: '2.0-static',
                    exportedAt: new Date().toISOString(),
                    source: 'GitHub',
                    repository: GITHUB_CONFIG.baseUrl,
                    agents: cart.map(item => {
                        const agent = agents.find(a => a.id === item.id);
                        const categoryDir = CATEGORY_TO_DIR[agent.category] || 'general_stacks';

                        // Agent ID uses hyphens for display, but filenames use underscores
                        const agentIdWithUnderscores = item.id.replace(/-/g, '_');
                        const stackName = agentIdWithUnderscores + '_stack';
                        const agentFileName = agentIdWithUnderscores + '_agent.py';
                        const demoFileName = agentIdWithUnderscores + '_demo.html';
                        const baseUrl = `${GITHUB_CONFIG.rawUrl}/agent_stacks/${categoryDir}/${stackName}`;

                        return {
                            id: item.id,
                            name: item.name,
                            category: item.category,
                            version: agent.version,
                            githubUrl: getAgentGitHubPath(item.id, item.category),
                            agentFile: `${baseUrl}/agents/${agentFileName}`,
                            metadataFile: `${baseUrl}/metadata.json`,
                            demoFile: `${baseUrl}/demos/${demoFileName}`
                        };
                    }),
                    installInstructions: `
üéâ RAPP Agent Package - Static GitHub Installation

‚úÖ ${cart.length} agent stack(s) ready for installation

üì• INSTALLATION OPTIONS:

Option 1: Automated Installation (Recommended)
   1. Save the 'install.sh' script
   2. Make it executable: chmod +x install.sh
   3. Run: ./install.sh
   4. Copy agents/*.py to your RAPP agents/ directory

Option 2: Manual Download
   Visit each agent's GitHub URL (see 'agents' array below)
   Download the agent Python file from the /agents/ subdirectory

Option 3: Direct curl
   Use the 'agentFile' URLs below to download individual files

üîß RAPP INTEGRATION:

Once downloaded:
   1. Place agent files in your RAPP project's agents/ directory
   2. Restart RAPP: ./run.sh
   3. Agents will be automatically loaded

üìö Documentation:
   Each agent includes a demo HTML file for testing
   Visit the GitHub repository for full documentation

üåê Repository: ${GITHUB_CONFIG.baseUrl}
`
                };

                // Create ZIP-like structure with multiple files
                const files = {
                    'install.sh': downloadScript,
                    'package.json': JSON.stringify(exportPackage, null, 2),
                    'README.md': exportPackage.installInstructions
                };

                // Download install script
                const scriptBlob = new Blob([downloadScript], { type: 'text/plain' });
                const scriptUrl = URL.createObjectURL(scriptBlob);
                const scriptLink = document.createElement('a');
                scriptLink.href = scriptUrl;
                scriptLink.download = `rapp_agents_install_${timestamp}.sh`;
                document.body.appendChild(scriptLink);
                scriptLink.click();
                document.body.removeChild(scriptLink);
                URL.revokeObjectURL(scriptUrl);

                // Download package JSON
                const jsonBlob = new Blob([JSON.stringify(exportPackage, null, 2)], { type: 'application/json' });
                const jsonUrl = URL.createObjectURL(jsonBlob);
                const jsonLink = document.createElement('a');
                jsonLink.href = jsonUrl;
                jsonLink.download = `rapp_agents_package_${timestamp}.json`;
                document.body.appendChild(jsonLink);
                jsonLink.click();
                document.body.removeChild(jsonLink);
                URL.revokeObjectURL(jsonUrl);

                // Show success message
                alert(`‚úÖ Success! ${cart.length} agent(s) packaged!\n\nüì¶ Downloads:\n‚Ä¢ install.sh - Automated installation script\n‚Ä¢ package.json - Agent details with GitHub URLs\n\nüîß Installation:\n1. Run: chmod +x install.sh && ./install.sh\n2. Copy agents/*.py to your RAPP agents/ directory\n3. Restart RAPP\n\nüåê All agents pulled from GitHub:\n${GITHUB_CONFIG.baseUrl}`);

                // Restore button
                exportBtn.textContent = originalText;
                exportBtn.disabled = false;

                // Clear cart
                cart = [];
                saveCart();
                updateCartCount();
                closeCart();
                renderAgents();

            } catch (error) {
                console.error('Error generating package:', error);
                alert(`‚ùå Error: ${error.message}\n\nPlease try again.`);

                // Restore button
                exportBtn.textContent = originalText;
                exportBtn.disabled = false;
            }
        }

        // View detailed agent/stack information in modal
        async function viewAgentDetails(agentId) {
            const agent = agents.find(a => a.id === agentId);
            if (!agent) return;

            // Remove existing modal if any
            const existingModal = document.getElementById('stackModalBackdrop');
            if (existingModal) {
                existingModal.remove();
            }

            // Create modal backdrop
            const backdrop = document.createElement('div');
            backdrop.id = 'stackModalBackdrop';

            // Create modal content
            const modal = document.createElement('div');
            modal.className = 'stack-modal';
            modal.style.padding = '2rem';

            // Load metadata for this stack
            const metadata = await loadStackMetadata(agent);

            // Build modal HTML
            let modalHTML = `
                <div class="modal-header-section">
                    <div>
                        <h2 class="modal-title">${agent.name}</h2>
                        <div class="modal-subtitle">
                            ${agent.version ? `Version ${agent.version}` : ''}
                            ${agent.author ? `‚Ä¢ by ${agent.author}` : ''}
                        </div>
                    </div>
                    <button class="modal-close-btn" onclick="closeAgentModal()">‚úï Close</button>
                </div>

                <div class="modal-badges">
                    <span class="modal-badge" style="background: ${getCategoryColor(agent.category)};">${agent.icon} ${agent.category}</span>
                    <span class="modal-badge" style="background: #3b82f6;">‚≠ê ${agent.rating}</span>
                    <span class="modal-badge" style="background: #8b5cf6;">üì¶ ${formatNumber(agent.installs)} installs</span>
                    <span class="modal-badge" style="background: #10b981;">v${agent.version}</span>
                </div>

                <div class="modal-section">
                    <h3 class="modal-section-title">Description</h3>
                    <p class="modal-section-content">${agent.shortDescription}</p>
                    ${metadata.longDescription ? `<p class="modal-section-content" style="margin-top: 1rem;">${metadata.longDescription}</p>` : ''}
                </div>
            `;

            // Components section
            modalHTML += `
                <div class="modal-section">
                    <h3 class="modal-section-title">Included Components (${metadata.components?.length || 1})</h3>
                    <div style="display: grid; gap: 0.75rem;">
            `;

            if (metadata.components && metadata.components.length > 0) {
                metadata.components.forEach(component => {
                    modalHTML += `
                        <div class="component-item">
                            <div>
                                <span class="component-name">${component.name}</span>
                                ${component.role ? `<span class="component-role">${component.role}</span>` : ''}
                            </div>
                            ${component.description ? `<p class="component-description">${component.description}</p>` : ''}
                        </div>
                    `;
                });
            } else {
                // Default component listing
                const agentFilename = `${agent.id.replace(/-/g, '_')}_agent.py`;
                modalHTML += `
                    <div class="component-item">
                        <div>
                            <span class="component-name">${agentFilename}</span>
                            <span class="component-role">Primary processing engine</span>
                        </div>
                        <p class="component-description">${agent.shortDescription}</p>
                    </div>
                `;
            }

            modalHTML += `</div></div>`;

            // Technical Requirements
            if (metadata.technicalRequirements) {
                modalHTML += `
                    <div class="modal-section">
                        <h3 class="modal-section-title">Technical Requirements</h3>
                        <div class="tech-requirements-box">
                            ${metadata.technicalRequirements.platforms ? `
                                <div class="tech-req-item">
                                    <span class="tech-req-label">Platforms:</span>
                                    <span class="tech-req-value">${metadata.technicalRequirements.platforms.join(', ')}</span>
                                </div>
                            ` : ''}
                            ${metadata.technicalRequirements.dependencies ? `
                                <div class="tech-req-item">
                                    <span class="tech-req-label">Dependencies:</span>
                                    <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                                        ${metadata.technicalRequirements.dependencies.map(dep => `
                                            <li style="color: #78350f; font-size: 0.9rem;">${dep}</li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${metadata.technicalRequirements.apiKeys ? `
                                <div class="tech-req-item">
                                    <span class="tech-req-label">Required API Keys:</span>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                                        ${metadata.technicalRequirements.apiKeys.map(key => `
                                            <code style="background: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">${key}</code>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            // Key Benefits
            if (metadata.benefits && metadata.benefits.length > 0) {
                modalHTML += `
                    <div class="modal-section">
                        <h3 class="modal-section-title">Key Benefits</h3>
                        <ul style="color: #666; padding-left: 1.5rem;">
                            ${metadata.benefits.map(benefit => `<li style="margin: 0.5rem 0;">${benefit}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            // Interactive Demo section
            if (metadata.demo && metadata.demo.available) {
                modalHTML += `
                    <div class="modal-section">
                        <h3 class="modal-section-title">üéÆ Interactive Demo</h3>
                        <div class="demo-box">
                            <h4 class="demo-title">${metadata.demo.title || 'Try the Demo'}</h4>
                            <p class="demo-description">${metadata.demo.description || 'Experience this stack with an interactive demonstration.'}</p>
                            <button class="demo-btn" onclick="window.open('${metadata.demo.url}', '_blank')">
                                üöÄ Launch Interactive Demo
                            </button>
                        </div>
                    </div>
                `;
            }

            // Action buttons
            modalHTML += `
                <div class="modal-actions">
                    ${!isInCart(agent.id) ? `
                        <button class="modal-btn modal-btn-primary" onclick="addToCart('${agent.id}'); closeAgentModal();">
                            ‚ûï Add Stack to Cart
                        </button>
                    ` : `
                        <button class="modal-btn modal-btn-disabled" disabled>
                            ‚úì Already in Cart
                        </button>
                    `}
                    ${metadata.demo && metadata.demo.available ? `
                        <button class="modal-btn modal-btn-secondary" onclick="window.open('${metadata.demo.url}', '_blank')">
                            üéÆ Try Demo
                        </button>
                    ` : ''}
                    <button class="modal-btn modal-btn-warning" onclick="exportTradingCard('${agent.id}')">
                        üì¶ Export Trading Card
                    </button>
                    <button class="modal-btn modal-btn-secondary" onclick="browseStackFiles('${agent.id}')">
                        üìÅ Browse Files
                    </button>
                </div>
            `;

            modal.innerHTML = modalHTML;
            backdrop.appendChild(modal);

            // Close on backdrop click
            backdrop.addEventListener('click', (e) => {
                if (e.target === backdrop) {
                    closeAgentModal();
                }
            });

            document.body.appendChild(backdrop);
        }

        // Close agent modal
        function closeAgentModal() {
            const modal = document.getElementById('stackModalBackdrop');
            if (modal) {
                modal.remove();
            }
        }

        // Load stack metadata from GitHub
        async function loadStackMetadata(agent) {
            const categoryDir = CATEGORY_TO_DIR[agent.category] || 'general_stacks';
            const agentIdWithUnderscores = agent.id.replace(/-/g, '_');
            const stackName = agentIdWithUnderscores + '_stack';

            try {
                const metadataUrl = `${GITHUB_CONFIG.rawUrl}/agent_stacks/${categoryDir}/${stackName}/metadata.json`;

                const response = await fetch(metadataUrl);
                if (response.ok) {
                    const metadata = await response.json();
                    console.log(`‚úÖ Loaded metadata for ${agent.id}:`, metadata);

                    // Check if demo file exists and add demo info
                    const demoFileName = `${agentIdWithUnderscores}_demo.html`;
                    const rawDemoUrl = `${GITHUB_CONFIG.rawUrl}/agent_stacks/${categoryDir}/${stackName}/demos/${demoFileName}`;
                    // Use htmlpreview.github.io to properly render HTML
                    const renderableDemoUrl = `https://htmlpreview.github.io/?${rawDemoUrl}`;

                    try {
                        const demoCheck = await fetch(rawDemoUrl, { method: 'HEAD' });
                        if (demoCheck.ok) {
                            metadata.demo = {
                                available: true,
                                title: `${agent.name} Interactive Demo`,
                                description: 'Experience this stack with an interactive demonstration showcasing real-world scenarios.',
                                url: renderableDemoUrl
                            };
                            console.log(`‚úÖ Demo found for ${agent.id}:`, renderableDemoUrl);
                        }
                    } catch (demoError) {
                        console.log(`‚ÑπÔ∏è No demo available for ${agent.id}`);
                    }

                    return metadata;
                }
            } catch (error) {
                console.warn(`‚ö†Ô∏è Could not load metadata for ${agent.id}:`, error);
            }

            // Return default metadata with demo check
            const demoFileName = `${agentIdWithUnderscores}_demo.html`;
            const rawDemoUrl = `${GITHUB_CONFIG.rawUrl}/agent_stacks/${categoryDir}/${stackName}/demos/${demoFileName}`;
            // Use htmlpreview.github.io to properly render HTML
            const renderableDemoUrl = `https://htmlpreview.github.io/?${rawDemoUrl}`;

            // Try to check if demo exists even if metadata fails
            let demoAvailable = false;
            try {
                const demoCheck = await fetch(rawDemoUrl, { method: 'HEAD' });
                demoAvailable = demoCheck.ok;
                if (demoAvailable) {
                    console.log(`‚úÖ Demo found for ${agent.id} (no metadata):`, renderableDemoUrl);
                }
            } catch (e) {
                console.log(`‚ÑπÔ∏è No demo available for ${agent.id}`);
            }

            return {
                components: [{
                    name: agent.name,
                    type: 'Agent',
                    description: agent.shortDescription
                }],
                technicalRequirements: {
                    platforms: ['Windows', 'macOS', 'Linux'],
                    dependencies: ['Python 3.11+', 'Azure Functions', 'requests'],
                    apiKeys: ['AZURE_OPENAI_API_KEY', 'AZURE_OPENAI_ENDPOINT']
                },
                benefits: [
                    'Automates complex workflows',
                    'Integrates with Microsoft 365',
                    'Reduces manual processing time'
                ],
                demo: demoAvailable ? {
                    available: true,
                    title: `${agent.name} Interactive Demo`,
                    description: 'Experience this stack with an interactive demonstration showcasing real-world scenarios.',
                    url: renderableDemoUrl
                } : {
                    available: false
                }
            };
        }

        // Get category color
        function getCategoryColor(category) {
            const colors = {
                'B2B Sales': '#6366f1',
                'B2C Sales': '#ec4899',
                'Energy': '#f59e0b',
                'Federal Government': '#3b82f6',
                'Financial Services': '#10b981',
                'Healthcare': '#ef4444',
                'Manufacturing': '#8b5cf6',
                'Professional Services': '#06b6d4',
                'Retail & CPG': '#f97316',
                'State/Local Government': '#14b8a6',
                'Utilities': '#6b7280',
                'Development': '#a855f7'
            };
            return colors[category] || '#6b7280';
        }

        // Export trading card for an agent
        async function exportTradingCard(agentId) {
            const agent = agents.find(a => a.id === agentId);
            if (!agent) return;

            try {
                console.log(`üì¶ Generating trading card for ${agent.name}...`);

                // Load metadata and agent code
                const metadata = await loadStackMetadata(agent);
                const agentCode = await loadAgentCode(agent);

                // Generate trading card HTML
                const tradingCardHTML = generateTradingCardHTML(agent, metadata, agentCode);

                // Create and download
                const blob = new Blob([tradingCardHTML], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${agent.id}_trading_card.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log(`‚úÖ Trading card exported successfully!`);
                alert(`Trading card exported for ${agent.name}!`);
            } catch (error) {
                console.error('Error exporting trading card:', error);
                alert('Failed to export trading card. Check console for details.');
            }
        }

        // Load agent code from GitHub
        async function loadAgentCode(agent) {
            try {
                const agentFilename = `${agent.id.replace(/-/g, '_')}_agent.py`;
                const url = getAgentRawUrl(agent.id, agent.category, `agents/${agentFilename}`);

                const response = await fetch(url);
                if (response.ok) {
                    return await response.text();
                }
            } catch (error) {
                console.warn(`Could not load agent code for ${agent.id}:`, error);
            }
            return '# Agent code not available';
        }

        // Generate trading card HTML
        function generateTradingCardHTML(agent, metadata, agentCode) {
            const escapedCode = agentCode.replace(/</g, '&lt;').replace(/>/g, '&gt;');

            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${agent.name} - Trading Card</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 2rem; background: #f9fafb; }
        .card { max-width: 800px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; }
        .content { padding: 2rem; }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 20px; margin-right: 0.5rem; font-size: 0.85rem; }
        .section { margin: 2rem 0; }
        .section-title { font-size: 1.3rem; color: #333; margin-bottom: 1rem; }
        pre { background: #f3f4f6; padding: 1rem; border-radius: 8px; overflow-x: auto; font-size: 0.9rem; line-height: 1.5; }
        .benefits { list-style: none; padding: 0; }
        .benefits li { padding: 0.5rem 0; padding-left: 1.5rem; position: relative; }
        .benefits li:before { content: "‚úì"; position: absolute; left: 0; color: #10b981; font-weight: bold; }
        .tech-box { background: #fef3c7; padding: 1rem; border-radius: 8px; border: 1px solid #fbbf24; }
        .footer { background: #f9fafb; padding: 1.5rem 2rem; text-align: center; color: #666; }
    </style>
</head>
<body>
    <div class="card">
        <div class="header">
            <h1>${agent.icon} ${agent.name}</h1>
            <div style="margin-top: 1rem;">
                <span class="badge">${agent.category}</span>
                <span class="badge">‚≠ê ${agent.rating}</span>
                <span class="badge">v${agent.version}</span>
                <span class="badge">${agent.author}</span>
            </div>
        </div>

        <div class="content">
            <div class="section">
                <h2 class="section-title">Description</h2>
                <p>${agent.shortDescription}</p>
            </div>

            ${metadata.benefits ? `
            <div class="section">
                <h2 class="section-title">Key Benefits</h2>
                <ul class="benefits">
                    ${metadata.benefits.map(b => `<li>${b}</li>`).join('')}
                </ul>
            </div>
            ` : ''}

            ${metadata.technicalRequirements ? `
            <div class="section">
                <h2 class="section-title">Technical Requirements</h2>
                <div class="tech-box">
                    ${metadata.technicalRequirements.platforms ? `<p><strong>Platforms:</strong> ${metadata.technicalRequirements.platforms.join(', ')}</p>` : ''}
                    ${metadata.technicalRequirements.dependencies ? `
                        <p style="margin-top: 0.5rem;"><strong>Dependencies:</strong></p>
                        <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                            ${metadata.technicalRequirements.dependencies.map(d => `<li>${d}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            </div>
            ` : ''}

            <div class="section">
                <h2 class="section-title">Agent Code</h2>
                <pre>${escapedCode}</pre>
            </div>
        </div>

        <div class="footer">
            <p>Generated by RAPP Agent Store ‚Ä¢ ${new Date().toLocaleDateString()}</p>
            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Visit <strong>github.com/kody-w/RAPP</strong> for more agents</p>
        </div>
    </div>
</body>
</html>`;
        }

        // Browse stack files on GitHub
        function browseStackFiles(agentId) {
            const agent = agents.find(a => a.id === agentId);
            if (!agent) {
                alert('Agent not found');
                return;
            }

            const githubUrl = getAgentGitHubPath(agentId, agent.category);
            window.open(githubUrl, '_blank');
        }

        // View details
        function viewDetails(agentId) {
            const agent = agents.find(a => a.id === agentId);
            const githubUrl = getAgentGitHubPath(agentId, agent.category);

            alert(`${agent.name}\n\n${agent.shortDescription}\n\nVersion: ${agent.version}\nRating: ${agent.rating}/5.0\nInstalls: ${formatNumber(agent.installs)}\n\nüåê GitHub Repository:\n${githubUrl}\n\nüìö Full documentation available at:\nhttps://kody-w.github.io/RAPP/`);
        }

        // Utility
        function formatNumber(num) {
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Chat functions (informational only - no backend)
        function toggleChat() {
            const chatPanel = document.querySelector('.chat-panel');
            chatPanel.style.display = chatPanel.style.display === 'none' ? 'flex' : 'none';
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addChatMessage('user', message);
            input.value = '';

            // Generate informational response
            setTimeout(() => {
                const response = getChatResponse(message);
                addChatMessage('assistant', response);
            }, 500);
        }

        function addChatMessage(role, content) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;

            messageDiv.innerHTML = `
                <div class="message-avatar ${role}">${role === 'user' ? 'üë§' : 'ü§ñ'}</div>
                <div class="message-content">${content}</div>
            `;

            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getChatResponse(message) {
            const lowerMsg = message.toLowerCase();

            if (lowerMsg.includes('install') || lowerMsg.includes('download')) {
                return `To install agents:\n\n1. Add agents to your cart\n2. Click "Export Cart" \n3. Download the install.sh script\n4. Run: chmod +x install.sh && ./install.sh\n5. Copy agents to your RAPP agents/ directory\n\nAll agents are pulled directly from GitHub - no backend required!`;
            }

            if (lowerMsg.includes('github') || lowerMsg.includes('repository')) {
                return `All agents are sourced from the GitHub repository:\n\n${GITHUB_CONFIG.baseUrl}\n\nClick "üìÅ Browse Files" on any agent card to view its source code on GitHub.`;
            }

            if (lowerMsg.includes('category') || lowerMsg.includes('filter')) {
                return `You can filter agents by:\n\n‚Ä¢ Category (12 industries)\n‚Ä¢ Search keywords\n‚Ä¢ Sort by popularity, rating, or name\n\nUse the filters at the top of the page!`;
            }

            if (lowerMsg.includes('cart')) {
                return `Your cart allows you to:\n\n‚Ä¢ Add multiple agents\n‚Ä¢ Export all at once\n‚Ä¢ Download installation scripts\n\nClick the cart icon (üõí) to view your selections!`;
            }

            return `This is a static agent marketplace powered by GitHub.\n\nFeatures:\n‚Ä¢ 78 agent stacks from AI-Agent-Templates\n‚Ä¢ Direct GitHub integration\n‚Ä¢ No backend required\n‚Ä¢ Automated installation scripts\n\nTry asking about:\n- How to install agents\n- GitHub repository\n- Filtering agents\n- Using the cart`;
        }

        // Close modal on escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCart();
            }
        });
    </script>
</body>
</html>
